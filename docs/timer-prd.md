# ⏱️ 시간분배 타이머 - 기능 명세서 (PRD)

## 1. 제품 개요

- **목표**: 사용자가 종료 시각을 설정하고, 해당 시간까지 집중할 수 있도록 돕는 타이머 시스템을 제공
- **특징**: 단순한 카운트다운이 아닌, 사용자 정의 작업 분배(퍼센트), 시각적 피드백(원형 그래프), 푸시/진동/소리 알림을 통해 몰입 환경 조성

---

## 2. 주요 기능

### ✅ 종료 시각 기반 타이머 설정
- 현재 시간 이후부터 당일 자정까지 종료 시각 설정 가능
- `TimeSelector` 컴포넌트를 통해 시간/분 직접 입력
- 현재 시각보다 이른 시간 선택 시 자동으로 다음 날로 설정
- 시간 설정은 저장 버튼 클릭 시에만 적용됨
- 빠른 시간 조절 버튼 제공 (-1시간, +1시간, -10분, +10분)

### ✅ 시간 기반 작업 분배
- 전체 타이머 시간(`totalTime`)을 기준으로 사용자가 설정한 작업 비율(`percentage`)만큼 시간(`duration`)을 자동 할당
- 예시: 90분 → 작업 A(60%), B(40%) → A: 54분, B: 36분

### ✅ CircleTimer 시각화 (SVG 기반)
- 전체 시간을 원형으로 표현하며 작업별 색상으로 분할
- 12시 방향에서 시작하여 시계 방향으로 진행
- 진행 중인 작업은 굵고 선명한 선으로 강조
- 진행률은 반투명한 파이 차트 형태로 표시
- 시작 전에는 작업 비율이 연하게 표시됨
- 완료 시 '완료!' 메시지와 함께 원형 애니메이션 출력

#### 중앙 시간 안내
1. 타이머 시작 전:
   - 현재 시각과 종료 시간을 함께 표시
   - 현재 시각은 1분 단위로 자동 업데이트
   - 표시 형식: "시작시간: nn시 nn분" (줄바꿈) "종료시간: nn시 nn분"
   - 시간이나 분이 0인 경우 해당 단위는 생략 (예: "3시" 또는 "30분")

2. 타이머 진행 중:
   - 현재 진행 중인 작업명과 남은 시간 표시
   - 표시 형식: "[작업명]" (줄바꿈) "HH:MM:SS"
   - 시간은 00:00:00 형식으로 표시 (2자리 숫자로 패딩)

#### 작업 개수 조절 버튼
- 타이머 시작 전에만 표시
- 원형 타이머 하단 좌우에 +/- 버튼 배치
- 버튼 스타일:
  - 원형 버튼 (32x32 픽셀)
  - 파란색 배경에 흰색 텍스트
  - 호버 시 색상 변경 효과
- 기능:
  - + 버튼: 새 작업 추가 (기존 작업들의 비율 자동 조정)
  - - 버튼: 마지막 작업 제거 (최소 1개 작업 유지)
  - 작업 수정 시 전체 시간 기준으로 작업 시간 자동 재계산

### ✅ 작업(Task) 관리
- 작업 이름 및 비율 입력 가능 (`TaskForm`)
- 비율 합계는 자동 조정 또는 수동 설정 가능
- `TaskList`를 통해 작업 삭제 가능
- 작업 개수 제한 없음

### ✅ 타이머 제어
- 시작: 모든 설정이 완료되면 활성화
- 초기화: 진행 중 상태 포함 전부 초기화 (확인 모달 포함)
- 일시정지: 현재 미지원(향후 계획)

### ✅ 알림 기능
- `Notification API`로 브라우저 푸시 알림 제공
- 모바일 환경에서 `navigator.vibrate()`를 통한 진동 알림

### ✅ 예외 처리

초기화 얼럿이 표시되는 상황:
1. 초기화 버튼 클릭
2. 브라우저 새로고침
3. Ctrl/Cmd + R 키 입력
4. 주소창 새로고침
5. Pull-to-refresh (모바일)

---

## 3. 컴포넌트 구조

| 컴포넌트 | 역할 |
|----------|------|
| TimeSelector | 종료 시각 설정 (드롭다운 + 빠른 설정 + 저장) |
| TaskForm | 작업 추가 (이름/비율) |
| TaskList | 작업 목록 관리 (조회/삭제) |
| CircleTimer | 진행률 시각화 (SVG 기반, 12시 방향 시작) |
| TimerHeader | 상태별 안내 메시지 |
| TimerButtons | 시작/초기화 버튼 |
| NotificationManager | 알림 권한 및 발송 관리 |

---

## 4. 기술 스택

- **Next.js** + **React (TypeScript)**
- **Tailwind CSS**: 스타일링
- **SVG**: 시각적 원형 진행률 구현
- **Date-fns**: 시간 계산
- **브라우저 API**: Notification, Vibrate, Audio

---

## 5. 향후 개선 방향

- 일시정지/재개 기능
- 작업별 상세 시간 표시
- 사용 이력 저장 (LocalStorage/DB)
- PWA 지원
- 커스텀 알림음 설정

---

## 6. 작성 정보

- 작성자: garam.kim  
- 작성일: 2025-05-18  
- 최근 업데이트: 시간 설정 저장 방식 변경, CircleTimer 개선, Pull-to-refresh 예외 처리 추가
